# After we flashed uBoot, uImage and uInitrd to the device memory, 
# we can not partition HDD drives and copy the rootfs to the root partition
# We do rootfs with last stable version of Debian by:
mkdir rootfs
sudo multistrap -a armhf -d rootfs -f rootfs.conf
# or
# apt install qemu-user-static
# debootstrap --arch=armhf --foreign --include=htop,net-tools buster rootfs/
# cp /usr/bin/qemu-arm-static usr/bin/
cd rootfs/
mount -t proc proc proc/
mount -t sysfs sys sys/
mount -o bind /dev dev/
cd ..
LC_ALL=C LANGUAGE=C LANG=C chroot rootfs/
#chroot --userspec=root:root rootfs
# Generate login mechanism
#touch /etc/passwd
adduser root -u 0
pam-auth-update
# Create root user with password "mycloud"
#echo "root:mycloud" | chpasswd
#shadowconfig on
#chown root:root -R *
#export PATH="$PATH:/sbin"
#source ~/.profile
rm usr/bin/qemu-arm-static
umount proc
umount sys
umount dev
exit
cd rootfs/
tar -cvf rootfs.tar.gz *

# Move files to the device on an USB drive and then copy them to the device
nount /dev/sdb1 /mnt/root
cp /dev/sdb1/rootfs.tag.gz /mnt/root/
cd /mnt/root/
tar -xvf rootfs.tar.gz
rm rootfs.tar.gs
cd ..
umount /dev/root
sync




# In order to make this rootfs able to boot we need to setup hostname, network (DHCP) and fstab.
